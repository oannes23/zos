{% if by_call_type %}
{% set total_cost = by_call_type | map(attribute='cost_usd') | sum %}
<table class="budget-table">
    <thead>
        <tr>
            <th>Call Type</th>
            <th class="text-right">Cost</th>
            <th class="text-right">% of Total</th>
            <th class="text-right">Tokens</th>
            <th class="text-right">Calls</th>
        </tr>
    </thead>
    <tbody>
        {% for ct in by_call_type %}
        <tr>
            <td>
                <span class="badge badge-{{ ct.call_type }}">{{ ct.call_type }}</span>
            </td>
            <td class="text-right">{{ ct.cost_usd | format_cost }}</td>
            <td class="text-right">
                {% if total_cost > 0 %}
                <div class="cost-bar-container">
                    <div class="cost-bar" style="width: {{ (ct.cost_usd / total_cost * 100) }}%"></div>
                    <span>{{ "%.1f" | format((ct.cost_usd / total_cost * 100)) }}%</span>
                </div>
                {% else %}
                0%
                {% endif %}
            </td>
            <td class="text-right">{{ ct.tokens | format_number }}</td>
            <td class="text-right">{{ ct.calls | format_number }}</td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr class="total-row">
            <td><strong>Total</strong></td>
            <td class="text-right"><strong>{{ total_cost | format_cost }}</strong></td>
            <td class="text-right">100%</td>
            <td class="text-right"><strong>{{ by_call_type | map(attribute='tokens') | sum | format_number }}</strong></td>
            <td class="text-right"><strong>{{ by_call_type | map(attribute='calls') | sum | format_number }}</strong></td>
        </tr>
    </tfoot>
</table>
{% else %}
<p class="text-muted">No call type cost data for the selected period</p>
{% endif %}

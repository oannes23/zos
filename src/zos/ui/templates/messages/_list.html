{% for message in messages %}
<div class="card message-card"
     hx-get="/ui/messages/{{ message.id }}"
     hx-push-url="true"
     hx-target="body"
     hx-swap="innerHTML">
    <div class="card-header">
        <span class="card-title">{{ message.author_name or message.author_id }}</span>
        <span class="badge badge-channel">#{{ message.channel_name or message.channel_id }}</span>
    </div>
    <p class="message-content">{{ message.content | truncate(300) }}</p>
    <div class="card-meta">
        <span class="temporal-marker">{{ message.temporal_marker }}</span>
        {% if message.reactions_aggregate %}
        <span class="reactions-count">
            {% set total_reactions = message.reactions_aggregate.values() | list | sum %}
            {{ total_reactions }} reaction{% if total_reactions != 1 %}s{% endif %}
        </span>
        {% endif %}
        {% if message.has_media %}<span class="badge badge-media">media</span>{% endif %}
        {% if message.has_links %}<span class="badge badge-links">links</span>{% endif %}
        {% if message.reply_to_id %}<span class="badge badge-reply">reply</span>{% endif %}
    </div>
</div>
{% endfor %}

{% if messages %}
<div class="pagination">
    {% if offset > 0 %}
    <button hx-get="/ui/messages/list?offset={{ offset - limit }}&limit={{ limit }}{% if channel_id %}&channel_id={{ channel_id }}{% endif %}{% if author_id %}&author_id={{ author_id }}{% endif %}{% if q %}&q={{ q }}{% endif %}"
            hx-target="#messages-list">
        Previous
    </button>
    {% endif %}

    <span class="page-info">{{ offset + 1 }}-{{ offset + messages|length }} of {{ total }}</span>

    {% if offset + limit < total %}
    <button hx-get="/ui/messages/list?offset={{ offset + limit }}&limit={{ limit }}{% if channel_id %}&channel_id={{ channel_id }}{% endif %}{% if author_id %}&author_id={{ author_id }}{% endif %}{% if q %}&q={{ q }}{% endif %}"
            hx-target="#messages-list">
        Next
    </button>
    {% endif %}
</div>
{% else %}
<p class="empty-state">No messages found.</p>
{% endif %}

{% if messages %}
<table class="messages-table data-table">
    <thead>
        <tr>
            <th>Author</th>
            <th>Channel</th>
            <th>Content</th>
            <th>Time</th>
            <th>Reactions</th>
            <th>Flags</th>
        </tr>
    </thead>
    <tbody>
        {% for message in messages %}
        <tr class="clickable"
            hx-get="/ui/messages/{{ message.id }}/modal"
            hx-target="#message-detail-modal"
            hx-swap="innerHTML">
            <td>
                {% if message.author_topic_key %}
                <a href="/ui/topics/{{ message.author_topic_key }}" class="entity-link" onclick="event.stopPropagation()">{{ message.author_name or message.author_id }}</a>
                {% else %}
                {{ message.author_name or message.author_id }}
                {% endif %}
            </td>
            <td>
                {% if message.channel_topic_key %}
                <a href="/ui/topics/{{ message.channel_topic_key }}" class="entity-link" onclick="event.stopPropagation()">#{{ message.channel_name or message.channel_id }}</a>
                {% else %}
                #{{ message.channel_name or message.channel_id }}
                {% endif %}
            </td>
            <td class="message-preview">{{ message.content | truncate(80) }}</td>
            <td class="text-muted">{{ message.temporal_marker }}</td>
            <td>
                {% if message.reactions_aggregate %}
                    {% set total_reactions = message.reactions_aggregate.values() | list | sum %}
                    {{ total_reactions }}
                {% endif %}
            </td>
            <td>
                {% if message.has_media %}<span class="badge badge-media">media</span>{% endif %}
                {% if message.has_links %}<span class="badge badge-links">links</span>{% endif %}
                {% if message.reply_to_id %}<span class="badge badge-reply">reply</span>{% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination">
    {% if offset > 0 %}
    <button hx-get="/ui/messages/list?offset={{ offset - limit }}&limit={{ limit }}{% if channel_id %}&channel_id={{ channel_id }}{% endif %}{% if author_id %}&author_id={{ author_id }}{% endif %}{% if q %}&q={{ q }}{% endif %}"
            hx-target="#messages-list">
        Previous
    </button>
    {% endif %}

    <span class="page-info">{{ offset + 1 }}-{{ offset + messages|length }} of {{ total }}</span>

    {% if offset + limit < total %}
    <button hx-get="/ui/messages/list?offset={{ offset + limit }}&limit={{ limit }}{% if channel_id %}&channel_id={{ channel_id }}{% endif %}{% if author_id %}&author_id={{ author_id }}{% endif %}{% if q %}&q={{ q }}{% endif %}"
            hx-target="#messages-list">
        Next
    </button>
    {% endif %}
</div>
{% else %}
<p class="empty-state">No messages found.</p>
{% endif %}

<div id="message-detail-modal" class="modal"></div>

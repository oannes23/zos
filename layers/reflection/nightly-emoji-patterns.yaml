# Nightly Emoji Reflection Layer
#
# Reflects on emojis as cultural artifacts — what they mean in this community,
# who reaches for them, what messages draw them out, how their usage evolves.
# Runs nightly at 3 AM, targeting emoji topics with salience >= 10.
#
# An emoji that accumulates salience has become part of the community's
# shared language. This layer reflects on that significance — not on
# any individual user's emoji habits (that belongs in user reflection).

name: nightly-emoji-patterns
category: emoji
description: |
  Reflect on emoji topics as cultural artifacts — their meaning in the
  community, who uses them, what draws them out, how usage evolves.

schedule: "0 3 * * *"  # Nightly at 3 AM
target_category: emoji
target_filter: "salience >= 10"  # Matches config salience.min_reflection_salience
max_targets: 10

nodes:
  - name: fetch_reactions
    type: fetch_reactions
    params:
      lookback_days: 7
      min_reactions: 5  # Only emojis with enough usage to analyze

  - name: fetch_prior_understanding
    type: fetch_insights
    params:
      retrieval_profile: recent
      max_per_topic: 5

  - name: reflect
    type: llm_call
    params:
      prompt_template: emoji/reflection.jinja2
      model: reflection
      max_tokens: 4096
      temperature: 0.7

  - name: store
    type: store_insight
    params:
      category: emoji_reflection
